<div class="container mx-auto p-5">
  <div class="d-flex align-items-center justify-content-between mb-5">
    <h1>User management</h1>
    <button type="button" class="btn btn-primary" (click)="showAddForm()">
      Add user
    </button>
  </div>

  <div *ngIf="(loading$ | async) === true">Loading...</div>
  <div *ngIf="error$ | async as error" class="alert alert-danger">
    {{ error }}
  </div>

  <div *ngIf="(users$ | async)?.length">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Username</th>
          <th>Email</th>
          <th>Address</th>
          <th>Company</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let user of users$ | async"
          style="border-bottom: 1px solid #ccc"
        >
          <td>{{ user.id }}</td>
          <td>{{ user.name }}</td>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.address.street }}, {{ user.address.city }}</td>
          <td>{{ user.company.name }}</td>
          <td class="d-flex align-items-center justify-content-center gap-2">
            <button class="btn btn-primary" (click)="showUpdateForm(user)">
              Edit
            </button>
            <button class="btn btn-danger" (click)="onDeleteUser(user.id)">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="method">
    <div class="d-flex align-items-center gap-5">
      <form
        #userForm="ngForm"
        class="d-flex flex-column gap-3"
        (ngSubmit)="handleSubmit(userForm)"
      >
        <input
          type="text"
          placeholder="User ID"
          [(ngModel)]="id"
          [ngModelOptions]="{ standalone: true }"
          [disabled]="method === 'edit'"
          class="border border-gray-300 rounded p-1"
        />
        <input
          type="text"
          placeholder="Name"
          [(ngModel)]="name"
          [ngModelOptions]="{ standalone: true }"
          class="border border-gray-300 rounded p-1"
        />
        <input
          type="text"
          placeholder="Username"
          [(ngModel)]="username"
          [ngModelOptions]="{ standalone: true }"
          class="border border-gray-300 rounded p-1"
        />
        <input
          type="email"
          placeholder="Email"
          [(ngModel)]="email"
          [ngModelOptions]="{ standalone: true }"
          class="border border-gray-300 rounded p-1"
        />
        <input
          type="text"
          placeholder="Address"
          [(ngModel)]="address"
          [ngModelOptions]="{ standalone: true }"
          class="border border-gray-300 rounded p-1"
        />
        <input
          type="text"
          placeholder="Company"
          [(ngModel)]="company"
          [ngModelOptions]="{ standalone: true }"
          class="border border-gray-300 rounded p-1"
        />
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-primary w-50">Save</button>
          <button class="btn btn-danger w-50" (click)="onReset()">
            Cancle
          </button>
        </div>
      </form>
      <div class="d-flex flex-column gap-3 flex-grow-2">
        <span class="d-flex align-items-center gap-2">
          <p class="fw-semibold">ID:</p>
          <p>{{ id }}</p>
        </span>
        <span class="d-flex align-items-center gap-2">
          <p class="fw-semibold">Name:</p>
          <p>{{ name }}</p>
        </span>
        <span class="d-flex align-items-center gap-2">
          <p class="fw-semibold">Username:</p>
          <p>{{ username }}</p>
        </span>
        <span class="d-flex align-items-center gap-2">
          <p class="fw-semibold">Email:</p>
          <p>{{ email }}</p>
        </span>
        <span class="d-flex align-items-center gap-2">
          <p class="fw-semibold">Address:</p>
          <p>{{ address }}</p>
        </span>
        <span class="d-flex align-items-center gap-2">
          <p class="fw-semibold">Company:</p>
          <p>{{ company }}</p>
        </span>
      </div>
    </div>
  </div>
</div>
